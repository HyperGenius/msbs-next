# Phase 3: User Experience & Game Loop Enhancement Roadmap

**作成日**: 2026年2月11日  
**更新日**: 2026年2月15日  
**目的**: ファーストユーザーの定着率向上と、継続的なプレイサイクルの確立

本ドキュメントは、MSBS-Nextの基盤機能（Phase 2.6完了時点）の上に、ゲームとしての面白さと遊びやすさを付加するための機能追加ロードマップです。

## 📊 実装状況

**✅ 1.1 初期機体の自動配布** - 完了 (2026-02-15)  
**✅ 1.2 チュートリアル・ガイダンス** - 完了 (2026-02-15)  
**✅ 2.1 武器ショップ** - 完了 (2026-02-15)  
**✅ 2.2 装備変更機能** - 完了 (2026-02-15)  
**✅ 3.1 ランキングシステム** - 完了 (2026-02-14)  
**✅ 3.2 他プレイヤーの視察** - 完了 (2026-02-14)  
**✅ 4.1 ネームドNPC / エースパイロット** - 完了 (2026-02-14)  
**✅ 4.2 NPCの個性化** - 完了 (2026-02-14)  
**🔄 5.1 モバイルUI調整** - 部分的に実装 (2026-02-15)  
**✅ 6. Storybook セットアップ** - 完了 (2026-02-15)

---

## 1. 🚀 Onboarding (初期体験の改善) - [Priority: Highest]

新規プレイヤーがゲームを開始した直後の「何をすればいいか分からない」状態を解消し、最初のバトルまでの導線をスムーズにします。

### 1.1 初期機体の自動配布 (Starter Kit) ✅ 実装完了 (2026-02-15)
* **現状:** ~~新規登録時はクレジットのみ所持しており、機体がないため何もできない。~~ → **解決済み**
* **実装内容:**
    * ✅ ユーザー作成時（`POST /api/pilots` 相当の処理時）に、デフォルト機体を自動で付与する機能を実装。
    * ✅ 「初期機体選択ボーナス」として、最初のログイン時に `Zaku II` または `GM` から1つ選ばせるモーダル（`StarterSelectionModal`）を実装。
    * ✅ バックエンド：`PilotService._create_starter_mobile_suit()` メソッドでスターター機体を作成・付与。
    * ✅ フロントエンド：`frontend/src/components/Tutorial/StarterSelectionModal.tsx` で機体選択UI実装。

### 1.2 チュートリアル・ガイダンス ✅ 実装完了 (2026-02-15)
* **現状:** ~~ガレージやショップへの誘導がない。~~ → **解決済み**
* **実装内容:**
    * ✅ 初回ログインユーザーに対し、画面上にガイド（オーバーレイ）を表示する機能を実装。
        1. 「ようこそパイロット！」(ウェルカムメッセージ)
        2. 「ステップ 1: ガレージ (Hangar)」- 機体の確認
        3. 「ステップ 2: バトルエントリー」- バトル参加方法
        4. 「ステップ 3: 報酬の獲得」- バトル後の報酬説明
        5. 「ステップ 4: Engineering へ」- 機体強化・カスタマイズ
    * ✅ フロントエンド：`frontend/src/components/Tutorial/OnboardingOverlay.tsx` でステップバイステップガイダンス実装。
    * ✅ localStorage を使用してオンボーディング完了状態を保存し、リピートユーザーには表示しない仕組みを実装。

---

## 2. 🔫 Weapon Customization (装備換装) - [Priority: High]

機体ごとの固定装備を廃止し、プレイヤーが戦略に合わせて武器を選べるようにします。これにより「戦術設定」の深みが増します。

### 2.1 武器ショップ (Weapon Shop) ✅ 実装完了 (2026-02-15)
* **現状:** ~~機体セット販売のみ。~~ → **解決済み**
* **実装内容:**
    * ✅ `Shop` APIを拡張し、武器単体（`Weapon`モデル）の販売に対応。
    * ✅ バックエンド：
        * `app/core/gamedata.py` に `WEAPON_SHOP_LISTINGS` を定義
        * `/api/shop/weapons` エンドポイントで武器一覧を取得
        * `/api/shop/purchase/weapon/{weapon_id}` で武器購入機能を実装
    * ✅ フロントエンド：
        * `frontend/src/app/shop/page.tsx` に「武器 (Weapons)」タブを追加
        * 武器ごとのパラメータ表示（属性、射程、威力、命中率、EN消費、クールダウンなど）
        * 購入確認ダイアログの実装
    * ✅ インベントリ管理：`Pilot.inventory` JSON フィールドで所持武器を管理

### 2.2 装備変更機能 (Loadout System) ✅ 実装完了 (2026-02-15)
* **現状:** ~~機体に武器が固定されている。~~ → **解決済み**
* **実装内容:**
    * ✅ バックエンド：
        * `MobileSuit` モデルと `Weapon` モデルの関係を見直し、所有している武器を自由に付け替えられるよう実装
        * `/api/mobile_suits/{ms_id}/equip` エンドポイントで武器装備機能を実装
        * パイロットのインベントリから武器の所持確認を実施
    * ✅ フロントエンド：
        * ガレージ画面（`frontend/src/app/garage/page.tsx`）に武器スロット表示を追加
        * 「装備変更」ボタンで武器選択モーダルを表示
        * 所持している武器の一覧から選択して装備可能
        * スロットインデックス指定で複数武器の管理が可能
    * ✅ Validation：所持していない武器は装備できない制限を実装
    * ⚠️ **今後の改善案**：機体ごとの積載制限や、装備可能な武器タイプ（例: ザクにビームライフルは不可など）の制限ロジックは未実装

---

## 3. 🏆 Competition (競争と交流) - [Priority: Medium]

PvPvEの醍醐味である「他者との比較」を可視化し、モチベーションを高めます。

### 3.1 ランキングシステム (Leaderboard) ✅ 実装完了 (2026-02-14)
* **現状:** 自分の戦績しか見えない。
* **実装内容:**
    * **Backend:** ✅ 定期バッチ処理時にランキングを集計するロジック追加（勝利数、撃墜数、獲得クレジット）。
        * `Season` テーブルと `Leaderboard` テーブルの実装
        * `RankingService` による集計ロジック
        * バッチ処理への統合
    * **Frontend:** ✅ 「ランキングページ」の新設。Top 100 プレイヤーの表示。
        * 自分の順位ハイライト
        * トップ3バッジ表示（金・銀・銅）
    * **Season制:** ✅ 一定期間（例: 1ヶ月）でランキングをリセットする機構。
* **実装レポート:** [RANKING_IMPLEMENTATION_SUMMARY.md](../reports/RANKING_IMPLEMENTATION_SUMMARY.md)

### 3.2 他プレイヤーの視察 (Inspection) ✅ 実装完了 (2026-02-14)
* **現状:** 相手の強さの理由がわからない。
* **実装内容:**
    * ✅ ランキングやバトル履歴から、他プレイヤーのアイコンをクリックして詳細プロフィールを表示。
    * ✅ 「現在使用中の機体」や「装備構成」を閲覧可能。
    * ✅ セキュリティ考慮（メールアドレス、所持クレジット等の非公開情報を除外）。
* **実装レポート:** [RANKING_IMPLEMENTATION_SUMMARY.md](../reports/RANKING_IMPLEMENTATION_SUMMARY.md)

---

## 4. 🌍 Immersion (世界観と没入感) - [Priority: Medium]

システム的な戦闘から、物語性のある戦闘体験へと昇華させます。

### 4.1 ネームドNPC / エースパイロット ✅ 実装完了 (2026-02-14)
* **現状:** ランダム生成の無機質なNPC。
* **実装内容:**
    * **固定NPCデータ:** ✅ 「赤い彗星」「青き巨星」「紫豚」「白い悪魔」「ハマーンの影」の5体を定義。
    * **レア出現:** ✅ バトルルーム生成時に5%確率でエースパイロットが乱入するロジック。
    * **特別報酬:** ✅ エース撃破時の特別ボーナス（大量の経験値、レア称号、専用武器のドロップなど）。
        * ボーナス経験値・クレジットの実装
* **実装レポート:** [ACE_PILOT_IMPLEMENTATION_SUMMARY.md](../reports/ACE_PILOT_IMPLEMENTATION_SUMMARY.md)

### 4.2 NPCの個性化 (Personality) ✅ 実装完了 (2026-02-14)
* **実装内容:**
    * ✅ NPCごとに「好戦的」「慎重」「遠距離主体」などの性格（AIロジック）を割り当て、行動パターンに変化をつける。
        * AGGRESSIVE (好戦的)
        * CAUTIOUS (慎重)
        * SNIPER (遠距離)
    * ✅ 戦闘ログにNPCのセリフ（カットイン的なテキスト）を表示。
        * 攻撃時、被弾時、撃墜時、ミス時のセリフ
        * 30%確率で発言（ログの可読性を保つ）
* **実装レポート:** [ACE_PILOT_IMPLEMENTATION_SUMMARY.md](../reports/ACE_PILOT_IMPLEMENTATION_SUMMARY.md)

---

## 5. 📱 Mobile Optimization (モバイル最適化) - [Priority: Low]

スマートフォンでのプレイ体験を向上させ、いつでもどこでも遊べるようにします。

### 5.1 モバイルUI調整 🔄 部分的に実装 (2026-02-15)
* **現状:** ~~3Dビューアの操作や細かなパラメータ表示がPC向け。~~ → **一部対応済み**
* **実装内容:**
    * ✅ **レスポンシブレイアウト**: Tailwind CSS のレスポンシブクラス（`sm:`, `md:`, `lg:`, `xl:`）を全ページに適用
        * グリッドレイアウトの調整（`grid-cols-1 md:grid-cols-2 lg:grid-cols-3` など）
        * テキストサイズの調整（`text-sm md:text-base lg:text-lg` など）
        * パディング・マージンの調整（`p-4 sm:p-6 md:p-8` など）
    * ✅ **モバイル対応コンポーネント**:
        * ダッシュボード（`EntryDashboard`, `CountdownTimer`）
        * チュートリアル（`OnboardingOverlay`, `StarterSelectionModal`）
        * ショップ（`shop/page.tsx`）
        * ガレージ（`garage/page.tsx`）
        * パイロット情報（`pilot/page.tsx`）
    * ⚠️ **今後の改善案**:
        * **3D Viewer**: タッチ操作に最適化したカメラモード（スワイプで回転、ピンチで拡大縮小）の感度調整。または「観戦モード（オートカメラワーク）」の実装。
        * **ボタン配置**: 重要なボタン（エントリー、戦闘開始）を画面下部に固定配置（Thumb Zoneへの対応）をさらに強化。
        * **文字サイズ**: スマホ画面でのユーザビリティテストに基づくフォントサイズの最適化。
        * **タッチターゲット**: モバイルデバイスでのタップ領域の最小サイズ確保（44x44px以上）。

---

## 6. 🎨 Storybook (コンポーネント開発環境) - [Priority: Medium]

UIコンポーネントの開発・テスト・ドキュメント化を効率化します。

### 6.1 Storybook セットアップ ✅ 実装完了 (2026-02-15)
* **実装内容:**
    * ✅ Storybook 10.x 系のインストール（`@storybook/nextjs-vite`）
    * ✅ Clerk（認証）のモック化機能実装（`.storybook/mocks/clerk.tsx`）
    * ✅ Tailwind CSS の統合設定
    * ✅ Story ファイルの作成:
        * `Header.stories.tsx`
        * `OnboardingOverlay.stories.tsx`
    * ✅ Vitest 統合設定（`@storybook/addon-vitest`）
    * ✅ 起動スクリプト: `npm run storybook`
* **ドキュメント:** [STORYBOOK_SETUP.md](../STORYBOOK_SETUP.md)

### 6.2 今後のStory追加予定
* **推奨される追加 Story**:
    * SciFi UIコンポーネント（`SciFiButton`, `SciFiPanel`, `SciFiCard` など）
    * Battle Viewer コンポーネント
    * Dashboard コンポーネント群
    * Shop コンポーネント（機体選択、武器選択）
    * ランキング表示コンポーネント

---

## 📅 推奨実装スケジュール

| フェーズ | 期間 (目安) | 主な目標 | 状況 |
| :--- | :--- | :--- | :--- |
| **Competition & Immersion** | 1週間 | ランキング・視察・エースパイロット | ✅ 完了 (2026-02-14) |
| **Onboarding** | 1週間 | 初期機体配布とチュートリアル表示の実装 | ✅ 完了 (2026-02-15) |
| **Weapon Customization** | 2週間 | 武器データの独立化、ショップでの武器販売、ガレージでの装備変更 | ✅ 完了 (2026-02-15) |
| **Storybook Setup** | 3日 | コンポーネント開発環境の構築 | ✅ 完了 (2026-02-15) |
| **Mobile Optimization** | 2週間 | モバイルUIの磨き込み | 🔄 進行中 (基礎対応完了) |

---

## 🎯 今後の推奨実装項目

### 優先度：高
1. **武器装備制限の実装**
   - 機体タイプごとの武器互換性チェック
   - 積載量制限の実装
   - UI/UXでの制限表示

2. **モバイルUI最適化の完成**
   - 3D Viewerのタッチ操作最適化
   - ボタン配置のThumb Zone対応
   - タップターゲットサイズの最適化

### 優先度：中
3. **Storybook Storyの拡充**
   - SciFi UIコンポーネント全体のStory作成
   - インタラクティブなテストケース追加
   - アクセシビリティチェックの統合

4. **パフォーマンス最適化**
   - バトルシミュレーションの最適化
   - 3Dレンダリングのパフォーマンス改善
   - API レスポンスタイムの最適化

### 優先度：低
5. **ゲームバランス調整**
   - 機体・武器のバランス調整
   - NPC強度の調整
   - 報酬バランスの見直し

---

## 📈 Phase 3 達成状況サマリー

**完了項目**: 8/10 (80%)  
**部分実装**: 1/10 (10%)  
**未着手**: 1/10 (10%)

### 主な成果
- ✅ 新規ユーザー体験の大幅改善（オンボーディング）
- ✅ 武器カスタマイズシステムの実装
- ✅ 競争要素の追加（ランキング・プレイヤー視察）
- ✅ 世界観の強化（エースパイロット・NPC個性化）
- ✅ 開発体験の向上（Storybook）
- 🔄 モバイル対応の基盤整備

### 残課題
- ⚠️ 武器装備制限システムの詳細化
- ⚠️ モバイルUI最適化の完成（3D Viewer、タッチ操作）
- ⚠️ パフォーマンス最適化
